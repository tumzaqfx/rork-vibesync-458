"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[86,398],{60086:(e,n,t)=>{t.r(n),t.d(n,{emailTemplates:()=>o});const i=e=>`\n<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <meta name="color-scheme" content="light dark">\n  <meta name="supported-color-schemes" content="light dark">\n  <style>\n  body {\n    margin: 0;\n    padding: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    background-color: #f5f5f5;\n    color: #1a1a1a;\n  }\n  .email-container {\n    max-width: 600px;\n    margin: 0 auto;\n    background-color: #ffffff;\n  }\n  .email-header {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    padding: 40px 20px;\n    text-align: center;\n  }\n  .email-logo {\n    font-size: 32px;\n    font-weight: bold;\n    color: #ffffff;\n    margin: 0;\n  }\n  .email-body {\n    padding: 40px 30px;\n  }\n  .email-title {\n    font-size: 24px;\n    font-weight: 600;\n    color: #1a1a1a;\n    margin: 0 0 20px 0;\n  }\n  .email-text {\n    font-size: 16px;\n    line-height: 1.6;\n    color: #4a4a4a;\n    margin: 0 0 20px 0;\n  }\n  .email-list {\n    margin: 20px 0;\n    padding-left: 20px;\n  }\n  .email-list li {\n    font-size: 16px;\n    line-height: 1.8;\n    color: #4a4a4a;\n    margin-bottom: 10px;\n  }\n  .email-button {\n    display: inline-block;\n    padding: 14px 32px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: #ffffff !important;\n    text-decoration: none;\n    border-radius: 8px;\n    font-weight: 600;\n    font-size: 16px;\n    margin: 20px 0;\n  }\n  .email-footer {\n    padding: 30px;\n    text-align: center;\n    background-color: #f9f9f9;\n    border-top: 1px solid #e0e0e0;\n  }\n  .email-footer-text {\n    font-size: 14px;\n    color: #888888;\n    margin: 5px 0;\n  }\n  .email-footer-link {\n    color: #667eea;\n    text-decoration: none;\n  }\n  .email-divider {\n    height: 1px;\n    background-color: #e0e0e0;\n    margin: 30px 0;\n  }\n  .email-highlight {\n    background-color: #f0f4ff;\n    padding: 15px;\n    border-radius: 8px;\n    margin: 20px 0;\n  }\n  @media (prefers-color-scheme: dark) {\n    body {\n      background-color: #1a1a1a;\n      color: #ffffff;\n    }\n    .email-container {\n      background-color: #2a2a2a;\n    }\n    .email-title {\n      color: #ffffff;\n    }\n    .email-text, .email-list li {\n      color: #cccccc;\n    }\n    .email-footer {\n      background-color: #1f1f1f;\n      border-top-color: #3a3a3a;\n    }\n    .email-highlight {\n      background-color: #2f3542;\n    }\n  }\n  @media only screen and (max-width: 600px) {\n    .email-body {\n      padding: 30px 20px;\n    }\n    .email-title {\n      font-size: 20px;\n    }\n    .email-text {\n      font-size: 15px;\n    }\n  }\n</style>\n</head>\n<body>\n  <div class="email-container">\n    <div class="email-header">\n      <h1 class="email-logo">VibeSync</h1>\n    </div>\n    ${e}\n    <div class="email-footer">\n      <p class="email-footer-text">You are receiving this email because you have an account with VibeSync.</p>\n      <p class="email-footer-text">\n        <a href="{unsubscribe_link}" class="email-footer-link">Manage email preferences</a> | \n        <a href="{unsubscribe_link}" class="email-footer-link">Unsubscribe</a>\n      </p>\n      <p class="email-footer-text">&copy; 2025 VibeSync. All rights reserved.</p>\n    </div>\n  </div>\n</body>\n</html>\n`,o={welcome:{type:"welcome",subject:"Welcome to VibeSync \u2013 Your World of Vibes & Connection \ud83c\udfb6",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">Welcome to VibeSync \u2014 where vibes, voice notes, and real connections come alive. \ud83c\udfa7</p>\n        <p class="email-text">With VibeSync, you can:</p>\n        <ul class="email-list">\n          <li>Post and comment with voice notes to make conversations feel real</li>\n          <li>Share vibes and playlists with friends</li>\n          <li>Discover people near you through our Friendship Heatmap</li>\n          <li>Sync experiences in real-time</li>\n        </ul>\n        <p class="email-text">\ud83d\udc49 Get started now and set up your profile.</p>\n        <a href="https://vibesync.com/profile/setup" class="email-button">Start Vibing</a>\n      </div>\n    '),textBody:"Hi {username},\n\nWelcome to VibeSync \u2014 where vibes, voice notes, and real connections come alive.\n\nWith VibeSync, you can:\n- Post and comment with voice notes to make conversations feel real\n- Share vibes and playlists with friends\n- Discover people near you through our Friendship Heatmap\n- Sync experiences in real-time\n\nGet started now: https://vibesync.com/profile/setup",category:"transactional"},email_verification:{type:"email_verification",subject:"Verify Your Email to Unlock VibeSync \ud83d\ude80",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">Thanks for signing up! Please confirm your email to unlock all VibeSync features.</p>\n        <a href="{verify_link}" class="email-button">Verify My Email</a>\n        <p class="email-text" style="color: #888888; font-size: 14px;">This link will expire in {expiry}.</p>\n      </div>\n    '),textBody:"Hi {username},\n\nThanks for signing up! Please confirm your email to unlock all VibeSync features.\n\nVerify your email: {verify_link}\n\nThis link will expire in {expiry}.",category:"transactional"},password_reset:{type:"password_reset",subject:"Reset Your VibeSync Password \ud83d\udd11",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">We received a request to reset your VibeSync password. If it was you, click below to set a new password.</p>\n        <a href="{reset_link}" class="email-button">Reset Password</a>\n        <p class="email-text" style="color: #888888; font-size: 14px;">This link will expire in {expiry}.</p>\n        <div class="email-divider"></div>\n        <p class="email-text" style="font-size: 14px;">If you didn\'t request this, you can ignore this email.</p>\n      </div>\n    '),textBody:"Hi {username},\n\nWe received a request to reset your VibeSync password. If it was you, click below to set a new password.\n\nReset password: {reset_link}\n\nThis link will expire in {expiry}.\n\nIf you didn't request this, you can ignore this email.",category:"transactional"},account_recovery:{type:"account_recovery",subject:"Need Help Recovering Your VibeSync Account? \ud83d\udee1\ufe0f",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">We noticed you requested help recovering your account. To keep your account secure, follow the steps below:</p>\n        <ul class="email-list">\n          <li>Click the secure recovery link</li>\n          <li>Verify your identity by confirming the code sent to your phone/email</li>\n          <li>Reset your password and review recent activity</li>\n        </ul>\n        <a href="{recovery_link}" class="email-button">Start Account Recovery</a>\n        <div class="email-divider"></div>\n        <p class="email-text" style="font-size: 14px; color: #d32f2f;">If you didn\'t request account recovery, please secure your account immediately or contact support.</p>\n      </div>\n    '),textBody:"Hi {username},\n\nWe noticed you requested help recovering your account. To keep your account secure, follow the steps below:\n\n1. Click the secure recovery link\n2. Verify your identity by confirming the code sent to your phone/email\n3. Reset your password and review recent activity\n\nStart recovery: {recovery_link}\n\nIf you didn't request account recovery, please secure your account immediately or contact support.",category:"transactional"},new_login_alert:{type:"new_login_alert",subject:"New Login Detected on Your VibeSync Account \u26a0\ufe0f",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">A new login was detected on your account.</p>\n        <div class="email-highlight">\n          <p class="email-text" style="margin: 5px 0;"><strong>Device:</strong> {device}</p>\n          <p class="email-text" style="margin: 5px 0;"><strong>Location:</strong> {location}</p>\n          <p class="email-text" style="margin: 5px 0;"><strong>Time:</strong> {timestamp}</p>\n        </div>\n        <p class="email-text">If this wasn\'t you, secure your account immediately.</p>\n        <a href="{secure_link}" class="email-button">Secure My Account</a>\n      </div>\n    '),textBody:"Hi {username},\n\nA new login was detected on your account.\n\nDevice: {device}\nLocation: {location}\nTime: {timestamp}\n\nIf this wasn't you, secure your account immediately: {secure_link}",category:"transactional"},friendship_follow:{type:"friendship_follow",subject:"{friend_name} Just Followed You on VibeSync \ud83c\udf89",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">Great news \u2014 <strong>{friend_name}</strong> just followed you on VibeSync!</p>\n        <p class="email-text">Check out their profile and follow back to stay connected.</p>\n        <a href="{friend_profile_link}" class="email-button">View Profile</a>\n      </div>\n    '),textBody:"Hi {username},\n\nGreat news \u2014 {friend_name} just followed you on VibeSync!\n\nCheck out their profile and follow back to stay connected.\n\nView profile: {friend_profile_link}",category:"notification"},playlist_sync:{type:"playlist_sync",subject:"{friend_name} Updated {playlist_name} on VibeSync \ud83c\udfb6",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text"><strong>{friend_name}</strong> just updated <strong>{playlist_name}</strong> \u2014 new vibes and voice notes were added.</p>\n        <p class="email-text">Don\'t miss out \u2014 open it now and vibe together.</p>\n        <a href="{playlist_link}" class="email-button">Open Playlist</a>\n      </div>\n    '),textBody:"Hi {username},\n\n{friend_name} just updated {playlist_name} \u2014 new vibes and voice notes were added.\n\nDon't miss out \u2014 open it now and vibe together.\n\nOpen playlist: {playlist_link}",category:"notification"},voice_note_interaction:{type:"voice_note_interaction",subject:"New Voice Note Reply from {friend_name} \ud83c\udfa4",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text"><strong>{friend_name}</strong> replied to your vibe with a voice note:</p>\n        <div class="email-highlight">\n          <p class="email-text" style="font-style: italic;">"{snippet_text}\u2026"</p>\n        </div>\n        <p class="email-text">Tap below to listen and reply.</p>\n        <a href="{vibe_link}" class="email-button">Listen Now</a>\n      </div>\n    '),textBody:'Hi {username},\n\n{friend_name} replied to your vibe with a voice note:\n\n"{snippet_text}\u2026"\n\nTap below to listen and reply: {vibe_link}',category:"notification"},engagement_boost:{type:"engagement_boost",subject:"We Miss You at VibeSync \ud83d\udc9c",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">It\'s been a while since your last vibe. Here\'s what you\'ve missed:</p>\n        <ul class="email-list">\n          <li><strong>{new_followers_count}</strong> new people followed you</li>\n          <li><strong>{friend_name}</strong> shared a new playlist</li>\n          <li>Trending vibes and voice notes in your city</li>\n        </ul>\n        <p class="email-text">Jump back in and catch up on the community.</p>\n        <a href="https://vibesync.com" class="email-button">Open VibeSync</a>\n      </div>\n    '),textBody:"Hi {username},\n\nIt's been a while since your last vibe. Here's what you've missed:\n\n- {new_followers_count} new people followed you\n- {friend_name} shared a new playlist\n- Trending vibes and voice notes in your city\n\nJump back in and catch up on the community: https://vibesync.com",category:"promotional"},order_confirmed:{type:"order_confirmed",subject:"Your VibeSync Order #{order_id} is Confirmed \u2705",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">Your order has been confirmed! We\'re preparing it for shipment.</p>\n        <div class="email-highlight">\n          <p class="email-text" style="margin: 5px 0;"><strong>Order ID:</strong> #{order_id}</p>\n          <p class="email-text" style="margin: 5px 0;"><strong>Status:</strong> {order_status}</p>\n        </div>\n        <a href="{order_link}" class="email-button">View Order Details</a>\n      </div>\n    '),textBody:"Hi {username},\n\nYour order has been confirmed! We're preparing it for shipment.\n\nOrder ID: #{order_id}\nStatus: {order_status}\n\nView order details: {order_link}",category:"transactional"},order_shipped:{type:"order_shipped",subject:"Your VibeSync Order #{order_id} is on the Way \ud83d\udce6",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">Great news! Your order has been shipped and is on its way to you.</p>\n        <div class="email-highlight">\n          <p class="email-text" style="margin: 5px 0;"><strong>Order ID:</strong> #{order_id}</p>\n          <p class="email-text" style="margin: 5px 0;"><strong>Status:</strong> {order_status}</p>\n        </div>\n        <a href="{order_link}" class="email-button">Track Your Order</a>\n      </div>\n    '),textBody:"Hi {username},\n\nGreat news! Your order has been shipped and is on its way to you.\n\nOrder ID: #{order_id}\nStatus: {order_status}\n\nTrack your order: {order_link}",category:"transactional"},order_delivered:{type:"order_delivered",subject:"Your VibeSync Order #{order_id} has Arrived \ud83c\udf81",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">Your order has been delivered! We hope you love it.</p>\n        <div class="email-highlight">\n          <p class="email-text" style="margin: 5px 0;"><strong>Order ID:</strong> #{order_id}</p>\n          <p class="email-text" style="margin: 5px 0;"><strong>Status:</strong> {order_status}</p>\n        </div>\n        <a href="{order_link}" class="email-button">View Order Details</a>\n      </div>\n    '),textBody:"Hi {username},\n\nYour order has been delivered! We hope you love it.\n\nOrder ID: #{order_id}\nStatus: {order_status}\n\nView order details: {order_link}",category:"transactional"},seller_notification:{type:"seller_notification",subject:"You've Got a New Order on VibeSync Marketplace",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">Congratulations! You have a new order on VibeSync Marketplace.</p>\n        <div class="email-highlight">\n          <p class="email-text" style="margin: 5px 0;"><strong>Order ID:</strong> #{order_id}</p>\n        </div>\n        <p class="email-text">Please prepare the order for shipment as soon as possible.</p>\n        <a href="{order_link}" class="email-button">View Order Details</a>\n      </div>\n    '),textBody:"Hi {username},\n\nCongratulations! You have a new order on VibeSync Marketplace.\n\nOrder ID: #{order_id}\n\nPlease prepare the order for shipment as soon as possible.\n\nView order details: {order_link}",category:"transactional"},policy_update:{type:"policy_update",subject:"Updates to VibeSync's Terms & Privacy Policy \ud83d\udcdc",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">We\'ve made important updates to our Terms of Service and Privacy Policy.</p>\n        <p class="email-text">Please review them to stay informed about how we protect and use your data.</p>\n        <a href="{update_link}" class="email-button">Read Updates</a>\n      </div>\n    '),textBody:"Hi {username},\n\nWe've made important updates to our Terms of Service and Privacy Policy.\n\nPlease review them to stay informed about how we protect and use your data.\n\nRead updates: {update_link}",category:"promotional"},monthly_digest:{type:"monthly_digest",subject:"Your VibeSync Recap \u2013 {month} \u2728",htmlBody:i('\n      <div class="email-body">\n        <h2 class="email-title">Hi {username},</h2>\n        <p class="email-text">Here\'s your month at a glance:</p>\n        <ul class="email-list">\n          <li><strong>Top voice note:</strong> {top_voice_note_title}</li>\n          <li><strong>New followers:</strong> {followers_count}</li>\n          <li><strong>Top vibe in your area:</strong> {top_vibe_title}</li>\n        </ul>\n        <p class="email-text">Ready for a fresh month of vibes?</p>\n        <a href="{explore_link}" class="email-button">Explore Now</a>\n      </div>\n    '),textBody:"Hi {username},\n\nHere's your month at a glance:\n\n- Top voice note: {top_voice_note_title}\n- New followers: {followers_count}\n- Top vibe in your area: {top_vibe_title}\n\nReady for a fresh month of vibes?\n\nExplore now: {explore_link}",category:"promotional"}}},89398:(e,n,t)=>{t.r(n),t.d(n,{EmailQueue:()=>c,EmailService:()=>l,emailQueue:()=>d});const i={NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"VibeSync",slug:"vibesync-q1osqc5",version:"1.0.0",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"vibesync",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},sdkVersion:"53.0.0",platforms:["ios","android","web"],extra:{router:{origin:"https://rork.com/"}}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.SENDGRID_API_KEY||"",o={NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"VibeSync",slug:"vibesync-q1osqc5",version:"1.0.0",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"vibesync",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},sdkVersion:"53.0.0",platforms:["ios","android","web"],extra:{router:{origin:"https://rork.com/"}}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.AWS_ACCESS_KEY_ID||"",s={NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"VibeSync",slug:"vibesync-q1osqc5",version:"1.0.0",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"vibesync",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},sdkVersion:"53.0.0",platforms:["ios","android","web"],extra:{router:{origin:"https://rork.com/"}}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.AWS_SECRET_ACCESS_KEY||"",a={NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"VibeSync",slug:"vibesync-q1osqc5",version:"1.0.0",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"vibesync",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},sdkVersion:"53.0.0",platforms:["ios","android","web"],extra:{router:{origin:"https://rork.com/"}}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.FROM_EMAIL||"noreply@vibesync.com",r={NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"VibeSync",slug:"vibesync-q1osqc5",version:"1.0.0",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"vibesync",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},sdkVersion:"53.0.0",platforms:["ios","android","web"],extra:{router:{origin:"https://rork.com/"}}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.FROM_NAME||"VibeSync";class l{constructor(){i&&""!==i?(this.provider="sendgrid",console.log("[EmailService] Using SendGrid provider")):o&&s&&""!==o&&""!==s?(this.provider="aws-ses",console.log("[EmailService] Using AWS SES provider")):(this.provider="mock",console.log("[EmailService] No email provider configured. Using mock mode."),console.log("[EmailService] To enable real emails, set SENDGRID_API_KEY or AWS credentials in .env"))}async sendEmail(e,n,t,i,o="transactional"){console.log(`[EmailService] Sending ${o} email to ${e}: ${n}`);try{switch(this.provider){case"sendgrid":return await this.sendViaSendGrid(e,n,t,i,o);case"aws-ses":return await this.sendViaAWSSES(e,n,t,i);case"mock":return this.sendViaMock(e,n,t,i);default:throw new Error("Unknown email provider")}}catch(s){return console.error("[EmailService] Error sending email:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async sendViaSendGrid(e,n,t,o,s){const l=await fetch("https://api.sendgrid.com/v3/mail/send",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({personalizations:[{to:[{email:e}]}],from:{email:a,name:r},subject:n,content:[{type:"text/plain",value:o},{type:"text/html",value:t}],categories:[s],tracking_settings:{click_tracking:{enable:!0},open_tracking:{enable:!0}}})});if(l.ok){return{success:!0,messageId:l.headers.get("x-message-id")||"unknown"}}return{success:!1,error:await l.text()}}async sendViaAWSSES(e,n,t,i){return console.log("[EmailService] AWS SES integration not fully implemented. Using mock."),this.sendViaMock(e,n,t,i)}sendViaMock(e,n,t,i){return console.log("\n========== MOCK EMAIL =========="),console.log(`To: ${e}`),console.log(`Subject: ${n}`),console.log("\n--- Text Body ---"),console.log(i),console.log("\n--- HTML Body Preview ---"),console.log(`${t.substring(0,500)}...`),console.log("================================\n"),{success:!0,messageId:`mock-${Date.now()}`}}async sendTemplateEmail(e,n){const t=this.replaceTokens(e.subject,n),i=this.replaceTokens(e.htmlBody,n),o=this.replaceTokens(e.textBody,n);return this.sendEmail(n.email,t,i,o,e.category)}replaceTokens(e,n){let t=e;for(const[i,o]of Object.entries(n)){const e=`{${i}}`;t=t.replace(new RegExp(e,"g"),String(o||""))}return t}async verifyEmailDeliverability(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}}class c{queue=[];processing=!1;constructor(){this.emailService=new l}async enqueue(e,n,t,i=3){const o={id:`email-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:e,trigger:n,payload:t,status:"pending",attempts:0,maxAttempts:i,createdAt:(new Date).toISOString()};return this.queue.push(o),console.log(`[EmailQueue] Enqueued ${e} email for ${t.email}`),this.processing||this.processQueue(),o.id}async processQueue(){if(!this.processing&&0!==this.queue.length){for(this.processing=!0;this.queue.length>0;){const e=this.queue[0];if("pending"!==e.status&&"retrying"!==e.status||await this.processItem(e),"sent"!==e.status&&"failed"!==e.status)break;this.queue.shift()}this.processing=!1}}async processItem(e){e.attempts++,console.log(`[EmailQueue] Processing ${e.type} (attempt ${e.attempts}/${e.maxAttempts})`);try{const n=function(e){const n=t(60086).emailTemplates[e];if(!n)throw new Error(`Email template not found: ${e}`);return n}(e.type),i=await this.emailService.sendTemplateEmail(n,e.payload);if(!i.success)throw new Error(i.error||"Unknown error");e.status="sent",e.sentAt=(new Date).toISOString(),console.log(`[EmailQueue] Successfully sent ${e.type} to ${e.payload.email}`)}catch(n){const t=n instanceof Error?n.message:"Unknown error";console.error(`[EmailQueue] Error sending ${e.type}:`,t),e.attempts>=e.maxAttempts?(e.status="failed",e.error=t,console.error(`[EmailQueue] Failed to send ${e.type} after ${e.attempts} attempts`)):(e.status="retrying",await new Promise((n=>setTimeout(n,1e3*e.attempts))))}}getQueueStatus(){return{pending:this.queue.filter((e=>"pending"===e.status)).length,sent:this.queue.filter((e=>"sent"===e.status)).length,failed:this.queue.filter((e=>"failed"===e.status)).length,retrying:this.queue.filter((e=>"retrying"===e.status)).length}}}const d=new c}}]);
//# sourceMappingURL=398.5d1599e7.chunk.js.map