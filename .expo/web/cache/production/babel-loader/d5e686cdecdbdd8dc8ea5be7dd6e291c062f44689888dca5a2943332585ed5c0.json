{"ast":null,"code":"import ExpoLocation from'./ExpoLocation';import{LocationEventEmitter}from'./LocationEventEmitter';let nextWatchId=0;class Subscriber{callbacks={};eventSubscription=null;constructor(eventName,eventDataField){this.eventName=eventName;this.eventDataField=eventDataField;}maybeInitializeSubscription(){if(this.eventSubscription){return;}this.eventSubscription=LocationEventEmitter.addListener(this.eventName,event=>this.trigger(event));}registerCallback(callback){this.maybeInitializeSubscription();const id=++nextWatchId;this.callbacks[id]=callback;return id;}registerCallbackForId(watchId,callback){this.maybeInitializeSubscription();const id=watchId;this.callbacks[id]=callback;return id;}unregisterCallback(id){if(!this.callbacks[id]){return;}delete this.callbacks[id];ExpoLocation.removeWatchAsync(id);if(Object.keys(this.callbacks).length===0&&this.eventSubscription){LocationEventEmitter.removeSubscription(this.eventSubscription);this.eventSubscription=null;}}trigger(event){const watchId=event.watchId;const callback=this.callbacks[watchId];if(callback){callback(event[this.eventDataField]);}else{ExpoLocation.removeWatchAsync(watchId);}}}export const LocationSubscriber=new Subscriber('Expo.locationChanged','location');export const HeadingSubscriber=new Subscriber('Expo.headingChanged','heading');export const LocationErrorSubscriber=new Subscriber('Expo.locationError','reason');export function _getCurrentWatchId(){return nextWatchId;}","map":{"version":3,"names":["ExpoLocation","LocationEventEmitter","nextWatchId","Subscriber","callbacks","eventSubscription","constructor","eventName","eventDataField","maybeInitializeSubscription","addListener","event","trigger","registerCallback","callback","id","registerCallbackForId","watchId","unregisterCallback","removeWatchAsync","Object","keys","length","removeSubscription","LocationSubscriber","HeadingSubscriber","LocationErrorSubscriber","_getCurrentWatchId"],"sources":["/home/user/rork-vibesync-458/node_modules/expo-location/src/LocationSubscribers.ts"],"sourcesContent":["import { type EventSubscription } from 'expo-modules-core';\n\nimport ExpoLocation from './ExpoLocation';\nimport { LocationCallback, LocationErrorCallback, LocationHeadingCallback } from './Location.types';\nimport { LocationEventEmitter } from './LocationEventEmitter';\n\ntype EventObject = {\n  watchId: number;\n  [key: string]: any;\n};\n\nlet nextWatchId = 0;\n\nclass Subscriber<\n  CallbackType extends LocationCallback | LocationHeadingCallback | LocationErrorCallback,\n> {\n  private eventName: string;\n  private eventDataField: string;\n  private callbacks: { [id: string]: CallbackType } = {};\n  private eventSubscription: EventSubscription | null = null;\n\n  constructor(eventName: string, eventDataField: string) {\n    this.eventName = eventName;\n    this.eventDataField = eventDataField;\n  }\n\n  maybeInitializeSubscription() {\n    if (this.eventSubscription) {\n      return;\n    }\n    this.eventSubscription = LocationEventEmitter.addListener(\n      this.eventName,\n      (event: EventObject) => this.trigger(event)\n    );\n  }\n\n  /**\n   * Registers given callback under new id which is then returned.\n   */\n  registerCallback(callback: CallbackType): number {\n    this.maybeInitializeSubscription();\n    const id = ++nextWatchId;\n    this.callbacks[id] = callback;\n    return id;\n  }\n\n  /**\n   * Registers given callback under and existing id. This can be used to\n   * create a subscriber for the error event on the same id as the location\n   * event is subscribed to.\n   */\n  registerCallbackForId(watchId: number, callback: CallbackType): number {\n    this.maybeInitializeSubscription();\n    const id = watchId;\n    this.callbacks[id] = callback;\n    return id;\n  }\n\n  /**\n   * Unregisters a callback with given id and revokes the subscription if possible.\n   */\n  unregisterCallback(id: number): void {\n    // Do nothing if we have already unregistered the callback.\n    if (!this.callbacks[id]) {\n      return;\n    }\n\n    delete this.callbacks[id];\n    ExpoLocation.removeWatchAsync(id);\n\n    if (Object.keys(this.callbacks).length === 0 && this.eventSubscription) {\n      LocationEventEmitter.removeSubscription(this.eventSubscription);\n      this.eventSubscription = null;\n    }\n  }\n\n  trigger(event: EventObject): void {\n    const watchId = event.watchId;\n    const callback = this.callbacks[watchId];\n\n    if (callback) {\n      callback(event[this.eventDataField]);\n    } else {\n      ExpoLocation.removeWatchAsync(watchId);\n    }\n  }\n}\n\nexport const LocationSubscriber = new Subscriber<LocationCallback>(\n  'Expo.locationChanged',\n  'location'\n);\nexport const HeadingSubscriber = new Subscriber<LocationHeadingCallback>(\n  'Expo.headingChanged',\n  'heading'\n);\n\nexport const LocationErrorSubscriber = new Subscriber<LocationErrorCallback>(\n  'Expo.locationError',\n  'reason'\n);\n\n/**\n * @private Necessary for some unit tests.\n */\nexport function _getCurrentWatchId(): number {\n  return nextWatchId;\n}\n"],"mappings":"AAEA,MAAO,CAAAA,YAAY,KAAM,gBAAgB,CAEzC,OAASC,oBAAoB,KAAQ,wBAAwB,CAO7D,GAAI,CAAAC,WAAW,CAAG,CAAC,CAEnB,KAAM,CAAAC,UAAU,CAKNC,SAAS,CAAmC,EAAE,CAC9CC,iBAAiB,CAA6B,IAAI,CAE1DC,YAAYC,SAAiB,CAAEC,cAAsB,EACnD,IAAI,CAACD,SAAS,CAAGA,SAAS,CAC1B,IAAI,CAACC,cAAc,CAAGA,cAAc,CACtC,CAEAC,2BAA2BA,CAAA,EACzB,GAAI,IAAI,CAACJ,iBAAiB,CAAE,CAC1B,OACF,CACA,IAAI,CAACA,iBAAiB,CAAGJ,oBAAoB,CAACS,WAAW,CACvD,IAAI,CAACH,SAAS,CACbI,KAAkB,EAAK,IAAI,CAACC,OAAO,CAACD,KAAK,CAAC,CAC5C,CACH,CAKAE,gBAAgBA,CAACC,QAAsB,EACrC,IAAI,CAACL,2BAA2B,EAAE,CAClC,KAAM,CAAAM,EAAE,CAAG,EAAEb,WAAW,CACxB,IAAI,CAACE,SAAS,CAACW,EAAE,CAAC,CAAGD,QAAQ,CAC7B,MAAO,CAAAC,EAAE,CACX,CAOAC,qBAAqBA,CAACC,OAAe,CAAEH,QAAsB,EAC3D,IAAI,CAACL,2BAA2B,EAAE,CAClC,KAAM,CAAAM,EAAE,CAAGE,OAAO,CAClB,IAAI,CAACb,SAAS,CAACW,EAAE,CAAC,CAAGD,QAAQ,CAC7B,MAAO,CAAAC,EAAE,CACX,CAKAG,kBAAkBA,CAACH,EAAU,EAE3B,GAAI,CAAC,IAAI,CAACX,SAAS,CAACW,EAAE,CAAC,CAAE,CACvB,OACF,CAEA,MAAO,KAAI,CAACX,SAAS,CAACW,EAAE,CAAC,CACzBf,YAAY,CAACmB,gBAAgB,CAACJ,EAAE,CAAC,CAEjC,GAAIK,MAAM,CAACC,IAAI,CAAC,IAAI,CAACjB,SAAS,CAAC,CAACkB,MAAM,GAAK,CAAC,EAAI,IAAI,CAACjB,iBAAiB,CAAE,CACtEJ,oBAAoB,CAACsB,kBAAkB,CAAC,IAAI,CAAClB,iBAAiB,CAAC,CAC/D,IAAI,CAACA,iBAAiB,CAAG,IAAI,CAC/B,CACF,CAEAO,OAAOA,CAACD,KAAkB,EACxB,KAAM,CAAAM,OAAO,CAAGN,KAAK,CAACM,OAAO,CAC7B,KAAM,CAAAH,QAAQ,CAAG,IAAI,CAACV,SAAS,CAACa,OAAO,CAAC,CAExC,GAAIH,QAAQ,CAAE,CACZA,QAAQ,CAACH,KAAK,CAAC,IAAI,CAACH,cAAc,CAAC,CAAC,CACtC,CAAC,IAAM,CACLR,YAAY,CAACmB,gBAAgB,CAACF,OAAO,CAAC,CACxC,CACF,C,CAGF,MAAO,MAAM,CAAAO,kBAAkB,CAAG,GAAI,CAAArB,UAAU,CAC9C,sBAAsB,CACtB,UAAU,CACX,CACD,MAAO,MAAM,CAAAsB,iBAAiB,CAAG,GAAI,CAAAtB,UAAU,CAC7C,qBAAqB,CACrB,SAAS,CACV,CAED,MAAO,MAAM,CAAAuB,uBAAuB,CAAG,GAAI,CAAAvB,UAAU,CACnD,oBAAoB,CACpB,QAAQ,CACT,CAKD,MAAM,SAAU,CAAAwB,kBAAkBA,CAAA,EAChC,MAAO,CAAAzB,WAAW,CACpB","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}