{"ast":null,"code":"import _objectWithoutPropertiesLoose from\"@babel/runtime/helpers/objectWithoutPropertiesLoose\";const _excluded=[\"uri\",\"width\",\"height\",\"blurhash\",\"priority\",\"cachePolicy\",\"style\"];import React,{useState,useEffect,memo}from'react';import{Image as ExpoImage}from'expo-image';import View from\"react-native-web/dist/exports/View\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import{imageCache}from'./image-cache';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const OptimizedImageComponent=_ref=>{let{uri,width,height,blurhash,priority='normal',cachePolicy='memory-disk',style}=_ref,props=_objectWithoutPropertiesLoose(_ref,_excluded);const[cachedUri,setCachedUri]=useState(uri);const[loading,setLoading]=useState(true);useEffect(()=>{let mounted=true;const loadImage=async()=>{if(!uri){setLoading(false);return;}try{if(cachePolicy!=='memory'){const cached=await imageCache.get(uri);if(cached&&mounted){setCachedUri(cached);}}}catch(error){console.warn('[OptimizedImage] Cache load error:',error);}finally{if(mounted){setLoading(false);}}};if(priority==='high'){loadImage();}else{const timeout=setTimeout(loadImage,priority==='normal'?0:100);return()=>clearTimeout(timeout);}return()=>{mounted=false;};},[uri,priority,cachePolicy]);return _jsxs(View,{style:[{width,height},style],children:[_jsx(ExpoImage,Object.assign({source:{uri:cachedUri},style:[StyleSheet.absoluteFill,style],placeholder:blurhash,contentFit:\"cover\",transition:200,cachePolicy:cachePolicy,priority:priority},props)),loading&&_jsx(View,{style:[StyleSheet.absoluteFill,styles.loadingContainer],children:_jsx(ActivityIndicator,{size:\"small\",color:\"#999\"})})]});};const styles=StyleSheet.create({loadingContainer:{justifyContent:'center',alignItems:'center',backgroundColor:'rgba(0,0,0,0.05)'}});export const OptimizedImage=memo(OptimizedImageComponent,(prev,next)=>{return prev.uri===next.uri&&prev.width===next.width&&prev.height===next.height&&prev.priority===next.priority;});","map":{"version":3,"names":["React","useState","useEffect","memo","Image","ExpoImage","View","ActivityIndicator","StyleSheet","imageCache","jsx","_jsx","jsxs","_jsxs","OptimizedImageComponent","_ref","uri","width","height","blurhash","priority","cachePolicy","style","props","_objectWithoutPropertiesLoose","_excluded","cachedUri","setCachedUri","loading","setLoading","mounted","loadImage","cached","get","error","console","warn","timeout","setTimeout","clearTimeout","children","Object","assign","source","absoluteFill","placeholder","contentFit","transition","styles","loadingContainer","size","color","create","justifyContent","alignItems","backgroundColor","OptimizedImage","prev","next"],"sources":["/home/user/rork-vibesync-458/utils/optimized-image.tsx"],"sourcesContent":["import React, { useState, useEffect, memo } from 'react';\nimport { Image as ExpoImage, ImageProps as ExpoImageProps } from 'expo-image';\nimport { View, ActivityIndicator, StyleSheet } from 'react-native';\nimport { imageCache } from './image-cache';\n\ninterface OptimizedImageProps extends Omit<ExpoImageProps, 'source'> {\n  uri: string;\n  width?: number;\n  height?: number;\n  blurhash?: string;\n  priority?: 'low' | 'normal' | 'high';\n  cachePolicy?: 'memory' | 'disk' | 'memory-disk';\n}\n\nconst OptimizedImageComponent: React.FC<OptimizedImageProps> = ({\n  uri,\n  width,\n  height,\n  blurhash,\n  priority = 'normal',\n  cachePolicy = 'memory-disk',\n  style,\n  ...props\n}) => {\n  const [cachedUri, setCachedUri] = useState<string>(uri);\n  const [loading, setLoading] = useState<boolean>(true);\n\n  useEffect(() => {\n    let mounted = true;\n\n    const loadImage = async () => {\n      if (!uri) {\n        setLoading(false);\n        return;\n      }\n\n      try {\n        if (cachePolicy !== 'memory') {\n          const cached = await imageCache.get(uri);\n          if (cached && mounted) {\n            setCachedUri(cached);\n          }\n        }\n      } catch (error) {\n        console.warn('[OptimizedImage] Cache load error:', error);\n      } finally {\n        if (mounted) {\n          setLoading(false);\n        }\n      }\n    };\n\n    if (priority === 'high') {\n      loadImage();\n    } else {\n      const timeout = setTimeout(loadImage, priority === 'normal' ? 0 : 100);\n      return () => clearTimeout(timeout);\n    }\n\n    return () => {\n      mounted = false;\n    };\n  }, [uri, priority, cachePolicy]);\n\n  return (\n    <View style={[{ width, height }, style]}>\n      <ExpoImage\n        source={{ uri: cachedUri }}\n        style={[StyleSheet.absoluteFill, style]}\n        placeholder={blurhash}\n        contentFit=\"cover\"\n        transition={200}\n        cachePolicy={cachePolicy}\n        priority={priority}\n        {...props}\n      />\n      {loading && (\n        <View style={[StyleSheet.absoluteFill, styles.loadingContainer]}>\n          <ActivityIndicator size=\"small\" color=\"#999\" />\n        </View>\n      )}\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  loadingContainer: {\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'rgba(0,0,0,0.05)',\n  },\n});\n\nexport const OptimizedImage = memo(OptimizedImageComponent, (prev, next) => {\n  return (\n    prev.uri === next.uri &&\n    prev.width === next.width &&\n    prev.height === next.height &&\n    prev.priority === next.priority\n  );\n});\n"],"mappings":"oLAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,IAAI,KAAQ,OAAO,CACxD,OAASC,KAAK,GAAI,CAAAC,SAAS,KAAsC,YAAY,CAAC,OAAAC,IAAA,iDAAAC,iBAAA,8DAAAC,UAAA,gDAE9E,OAASC,UAAU,KAAQ,eAAe,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAW3C,KAAM,CAAAC,uBAAsD,CAAGC,IAAA,EASzD,IAT0D,CAC9DC,GAAG,CACHC,KAAK,CACLC,MAAM,CACNC,QAAQ,CACRC,QAAQ,CAAG,QAAQ,CACnBC,WAAW,CAAG,aAAa,CAC3BC,KAEF,CAAC,CAAAP,IAAA,CADIQ,KAAK,CAAAC,6BAAA,CAAAT,IAAA,CAAAU,SAAA,EAER,KAAM,CAACC,SAAS,CAAEC,YAAY,CAAC,CAAG1B,QAAQ,CAASe,GAAG,CAAC,CACvD,KAAM,CAACY,OAAO,CAAEC,UAAU,CAAC,CAAG5B,QAAQ,CAAU,IAAI,CAAC,CAErDC,SAAS,CAAC,IAAM,CACd,GAAI,CAAA4B,OAAO,CAAG,IAAI,CAElB,KAAM,CAAAC,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC5B,GAAI,CAACf,GAAG,CAAE,CACRa,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CAEA,GAAI,CACF,GAAIR,WAAW,GAAK,QAAQ,CAAE,CAC5B,KAAM,CAAAW,MAAM,CAAG,KAAM,CAAAvB,UAAU,CAACwB,GAAG,CAACjB,GAAG,CAAC,CACxC,GAAIgB,MAAM,EAAIF,OAAO,CAAE,CACrBH,YAAY,CAACK,MAAM,CAAC,CACtB,CACF,CACF,CAAE,MAAOE,KAAK,CAAE,CACdC,OAAO,CAACC,IAAI,CAAC,oCAAoC,CAAEF,KAAK,CAAC,CAC3D,CAAC,OAAS,CACR,GAAIJ,OAAO,CAAE,CACXD,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CACF,CAAC,CAED,GAAIT,QAAQ,GAAK,MAAM,CAAE,CACvBW,SAAS,CAAC,CAAC,CACb,CAAC,IAAM,CACL,KAAM,CAAAM,OAAO,CAAGC,UAAU,CAACP,SAAS,CAAEX,QAAQ,GAAK,QAAQ,CAAG,CAAC,CAAG,GAAG,CAAC,CACtE,MAAO,IAAMmB,YAAY,CAACF,OAAO,CAAC,CACpC,CAEA,MAAO,IAAM,CACXP,OAAO,CAAG,KAAK,CACjB,CAAC,CACH,CAAC,CAAE,CAACd,GAAG,CAAEI,QAAQ,CAAEC,WAAW,CAAC,CAAC,CAEhC,MACE,CAAAR,KAAA,CAACP,IAAI,EAACgB,KAAK,CAAE,CAAC,CAAEL,KAAK,CAAEC,MAAO,CAAC,CAAEI,KAAK,CAAE,CAAAkB,QAAA,EACtC7B,IAAA,CAACN,SAAS,CAAAoC,MAAA,CAAAC,MAAA,EACRC,MAAM,CAAE,CAAE3B,GAAG,CAAEU,SAAU,CAAE,CAC3BJ,KAAK,CAAE,CAACd,UAAU,CAACoC,YAAY,CAAEtB,KAAK,CAAE,CACxCuB,WAAW,CAAE1B,QAAS,CACtB2B,UAAU,CAAC,OAAO,CAClBC,UAAU,CAAE,GAAI,CAChB1B,WAAW,CAAEA,WAAY,CACzBD,QAAQ,CAAEA,QAAS,EACfG,KAAK,CACV,CAAC,CACDK,OAAO,EACNjB,IAAA,CAACL,IAAI,EAACgB,KAAK,CAAE,CAACd,UAAU,CAACoC,YAAY,CAAEI,MAAM,CAACC,gBAAgB,CAAE,CAAAT,QAAA,CAC9D7B,IAAA,CAACJ,iBAAiB,EAAC2C,IAAI,CAAC,OAAO,CAACC,KAAK,CAAC,MAAM,CAAE,CAAC,CAC3C,CACP,EACG,CAAC,CAEX,CAAC,CAED,KAAM,CAAAH,MAAM,CAAGxC,UAAU,CAAC4C,MAAM,CAAC,CAC/BH,gBAAgB,CAAE,CAChBI,cAAc,CAAE,QAAQ,CACxBC,UAAU,CAAE,QAAQ,CACpBC,eAAe,CAAE,kBACnB,CACF,CAAC,CAAC,CAEF,MAAO,MAAM,CAAAC,cAAc,CAAGrD,IAAI,CAACW,uBAAuB,CAAE,CAAC2C,IAAI,CAAEC,IAAI,GAAK,CAC1E,MACE,CAAAD,IAAI,CAACzC,GAAG,GAAK0C,IAAI,CAAC1C,GAAG,EACrByC,IAAI,CAACxC,KAAK,GAAKyC,IAAI,CAACzC,KAAK,EACzBwC,IAAI,CAACvC,MAAM,GAAKwC,IAAI,CAACxC,MAAM,EAC3BuC,IAAI,CAACrC,QAAQ,GAAKsC,IAAI,CAACtC,QAAQ,CAEnC,CAAC,CAAC","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}