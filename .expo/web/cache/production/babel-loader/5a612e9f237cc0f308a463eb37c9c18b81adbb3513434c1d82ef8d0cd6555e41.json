{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import View from\"react-native-web/dist/exports/View\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Text from\"react-native-web/dist/exports/Text\";import Animated from\"react-native-web/dist/exports/Animated\";import Platform from\"react-native-web/dist/exports/Platform\";import{Play,Pause}from'lucide-react-native';import{useTheme}from'@/hooks/theme-store';import{Audio}from'expo-av';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const VoicePlayer=({url,duration,waveform,size='medium',testID})=>{const{colors}=useTheme();const[isPlaying,setIsPlaying]=useState(false);const[currentTime,setCurrentTime]=useState(0);const[sound,setSound]=useState(null);const progressAnim=useRef(new Animated.Value(0)).current;const sizeConfig={small:{button:32,waveHeight:24,fontSize:10},medium:{button:40,waveHeight:32,fontSize:12},large:{button:48,waveHeight:40,fontSize:14}};const config=sizeConfig[size];useEffect(()=>{return()=>{if(sound&&false){sound.unloadAsync().catch(console.error);}};},[sound]);const formatTime=seconds=>{const mins=Math.floor(seconds/60);const secs=Math.floor(seconds%60);return`${mins}:${secs.toString().padStart(2,'0')}`;};const handlePlayPause=async()=>{if(true){return;}try{if(!sound){await Audio.setAudioModeAsync({playsInSilentModeIOS:true,staysActiveInBackground:false});const{sound:newSound}=await Audio.Sound.createAsync({uri:url},{shouldPlay:true},onPlaybackStatusUpdate);setSound(newSound);setIsPlaying(true);}else{const status=await sound.getStatusAsync();if(status.isLoaded){if(isPlaying){await sound.pauseAsync();setIsPlaying(false);}else{await sound.playAsync();setIsPlaying(true);}}}}catch(error){console.error('Error playing audio:',error);}};const onPlaybackStatusUpdate=status=>{if(status.isLoaded){setCurrentTime(status.positionMillis/1000);const progress=status.positionMillis/(duration*1000);progressAnim.setValue(progress);if(status.didJustFinish){setIsPlaying(false);setCurrentTime(0);progressAnim.setValue(0);}}};const generateWaveform=()=>{if(waveform&&waveform.length>0){return waveform;}return Array.from({length:30},()=>Math.random()*0.5+0.3);};const waveformData=generateWaveform();return _jsxs(View,{style:[styles.container,{backgroundColor:colors.card}],testID:testID,children:[_jsx(TouchableOpacity,{style:[styles.playButton,{backgroundColor:colors.primary,width:config.button,height:config.button,borderRadius:config.button/2}],onPress:handlePlayPause,children:isPlaying?_jsx(Pause,{size:config.button*0.5,color:colors.textInverse,fill:colors.textInverse}):_jsx(Play,{size:config.button*0.5,color:colors.textInverse,fill:colors.textInverse})}),_jsxs(View,{style:styles.waveformContainer,children:[_jsx(View,{style:[styles.waveform,{height:config.waveHeight}],children:waveformData.map((height,index)=>{const progress=currentTime/duration;const isPassed=index/waveformData.length<progress;return _jsx(View,{style:[styles.waveformBar,{height:`${height*100}%`,backgroundColor:isPassed?colors.primary:colors.border}]},index);})}),_jsx(Text,{style:[styles.timeText,{color:colors.textSecondary,fontSize:config.fontSize}],children:formatTime(isPlaying?currentTime:duration)})]})]});};const styles=StyleSheet.create({container:{flexDirection:'row',alignItems:'center',paddingHorizontal:12,paddingVertical:8,borderRadius:20,gap:12},playButton:{justifyContent:'center',alignItems:'center'},waveformContainer:{flex:1,flexDirection:'row',alignItems:'center',gap:8},waveform:{flex:1,flexDirection:'row',alignItems:'center',gap:2},waveformBar:{flex:1,borderRadius:2},timeText:{fontWeight:'600',minWidth:35}});","map":{"version":3,"names":["React","useState","useEffect","useRef","StyleSheet","View","TouchableOpacity","Text","Animated","Platform","Play","Pause","useTheme","Audio","jsx","_jsx","jsxs","_jsxs","VoicePlayer","url","duration","waveform","size","testID","colors","isPlaying","setIsPlaying","currentTime","setCurrentTime","sound","setSound","progressAnim","Value","current","sizeConfig","small","button","waveHeight","fontSize","medium","large","config","unloadAsync","catch","console","error","formatTime","seconds","mins","Math","floor","secs","toString","padStart","handlePlayPause","setAudioModeAsync","playsInSilentModeIOS","staysActiveInBackground","newSound","Sound","createAsync","uri","shouldPlay","onPlaybackStatusUpdate","status","getStatusAsync","isLoaded","pauseAsync","playAsync","positionMillis","progress","setValue","didJustFinish","generateWaveform","length","Array","from","random","waveformData","style","styles","container","backgroundColor","card","children","playButton","primary","width","height","borderRadius","onPress","color","textInverse","fill","waveformContainer","map","index","isPassed","waveformBar","border","timeText","textSecondary","create","flexDirection","alignItems","paddingHorizontal","paddingVertical","gap","justifyContent","flex","fontWeight","minWidth"],"sources":["/home/user/rork-vibesync-458/components/ui/VoicePlayer.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { StyleSheet, View, TouchableOpacity, Text, Animated, Platform } from 'react-native';\nimport { Play, Pause } from 'lucide-react-native';\nimport { useTheme } from '@/hooks/theme-store';\nimport { Audio } from 'expo-av';\n\ninterface VoicePlayerProps {\n  url: string;\n  duration: number;\n  waveform?: number[];\n  size?: 'small' | 'medium' | 'large';\n  testID?: string;\n}\n\nexport const VoicePlayer: React.FC<VoicePlayerProps> = ({\n  url,\n  duration,\n  waveform,\n  size = 'medium',\n  testID,\n}) => {\n  const { colors } = useTheme();\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [sound, setSound] = useState<Audio.Sound | null>(null);\n  const progressAnim = useRef(new Animated.Value(0)).current;\n\n  const sizeConfig = {\n    small: { button: 32, waveHeight: 24, fontSize: 10 },\n    medium: { button: 40, waveHeight: 32, fontSize: 12 },\n    large: { button: 48, waveHeight: 40, fontSize: 14 },\n  };\n\n  const config = sizeConfig[size];\n\n  useEffect(() => {\n    return () => {\n      if (sound && Platform.OS !== 'web') {\n        sound.unloadAsync().catch(console.error);\n      }\n    };\n  }, [sound]);\n\n  const formatTime = (seconds: number): string => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const handlePlayPause = async () => {\n    if (Platform.OS === 'web') {\n      return;\n    }\n    try {\n      if (!sound) {\n        await Audio.setAudioModeAsync({\n          playsInSilentModeIOS: true,\n          staysActiveInBackground: false,\n        });\n\n        const { sound: newSound } = await Audio.Sound.createAsync(\n          { uri: url },\n          { shouldPlay: true },\n          onPlaybackStatusUpdate\n        );\n        setSound(newSound);\n        setIsPlaying(true);\n      } else {\n        const status = await sound.getStatusAsync();\n        if (status.isLoaded) {\n          if (isPlaying) {\n            await sound.pauseAsync();\n            setIsPlaying(false);\n          } else {\n            await sound.playAsync();\n            setIsPlaying(true);\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Error playing audio:', error);\n    }\n  };\n\n  const onPlaybackStatusUpdate = (status: any) => {\n    if (status.isLoaded) {\n      setCurrentTime(status.positionMillis / 1000);\n      const progress = status.positionMillis / (duration * 1000);\n      progressAnim.setValue(progress);\n\n      if (status.didJustFinish) {\n        setIsPlaying(false);\n        setCurrentTime(0);\n        progressAnim.setValue(0);\n      }\n    }\n  };\n\n  const generateWaveform = () => {\n    if (waveform && waveform.length > 0) {\n      return waveform;\n    }\n    return Array.from({ length: 30 }, () => Math.random() * 0.5 + 0.3);\n  };\n\n  const waveformData = generateWaveform();\n\n  return (\n    <View style={[styles.container, { backgroundColor: colors.card }]} testID={testID}>\n      <TouchableOpacity\n        style={[\n          styles.playButton,\n          {\n            backgroundColor: colors.primary,\n            width: config.button,\n            height: config.button,\n            borderRadius: config.button / 2,\n          },\n        ]}\n        onPress={handlePlayPause}\n      >\n        {isPlaying ? (\n          <Pause size={config.button * 0.5} color={colors.textInverse} fill={colors.textInverse} />\n        ) : (\n          <Play size={config.button * 0.5} color={colors.textInverse} fill={colors.textInverse} />\n        )}\n      </TouchableOpacity>\n\n      <View style={styles.waveformContainer}>\n        <View style={[styles.waveform, { height: config.waveHeight }]}>\n          {waveformData.map((height, index) => {\n            const progress = currentTime / duration;\n            const isPassed = index / waveformData.length < progress;\n            return (\n              <View\n                key={index}\n                style={[\n                  styles.waveformBar,\n                  {\n                    height: `${height * 100}%`,\n                    backgroundColor: isPassed ? colors.primary : colors.border,\n                  },\n                ]}\n              />\n            );\n          })}\n        </View>\n        <Text style={[styles.timeText, { color: colors.textSecondary, fontSize: config.fontSize }]}>\n          {formatTime(isPlaying ? currentTime : duration)}\n        </Text>\n      </View>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    paddingHorizontal: 12,\n    paddingVertical: 8,\n    borderRadius: 20,\n    gap: 12,\n  },\n  playButton: {\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  waveformContainer: {\n    flex: 1,\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 8,\n  },\n  waveform: {\n    flex: 1,\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 2,\n  },\n  waveformBar: {\n    flex: 1,\n    borderRadius: 2,\n  },\n  timeText: {\n    fontWeight: '600' as const,\n    minWidth: 35,\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}